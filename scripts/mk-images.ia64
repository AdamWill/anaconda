# No modules yet
SECSTAGE="fat vfat raid0 raid1 raid5"

prepareBootImage() {
	gunzip < $BOOTDISKDIR/bootfs.gz > $MBD_TMPIMAGE
	mount -o loop,offset=16384 -t vfat $MBD_TMPIMAGE $MBD_BOOTTREE
	cp $MBD_FSIMAGE $MBD_BOOTTREE/initrd.img

	cp $KERNELROOT/boot/efi/vmlinux-* $MBD_BOOTTREE/vmlinux
}

makebootdisk --kernelto $TOPDESTPATH/kernels/vmlinux  \
	     --imagename boot.img \
	     --initrdflags '--initrdto $TOPDESTPATH/images/ramdisk.img \
		     	    --initrdsize 4096 \
			    --loaderbin loader'

makeinstimage --size1 8192 --size2 8192 "netstg" "$SECSTAGE"
makeinstimage --size1 8192 --size2 8192 "hdstg" "$SECSTAGE"
makemainmodules "$SECSTAGE"
makemainimage "stage2"
